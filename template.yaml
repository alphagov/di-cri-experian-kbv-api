# Reference: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html
# Resources Generated By SAM: https://github.com/aws/serverless-application-model/blob/master/docs/internals/generated_resources.rst

AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Digital Identity IPV Core Backend lambdas

Globals:
  Function:
    Timeout: 60 # seconds
    Runtime: java11
    AutoPublishAlias: live
    MemorySize: 512

Resources:

  GetQuestionsFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: build/distributions/di-cri-experian-kbv-api.zip
      Handler: uk.gov.di.ipv.cri.kbv.GetQuestionsHandler
      VpcConfig:
        SecurityGroupIds:
          - sg-03a1efaf2fed58442
        SubnetIds:
          - subnet-07fcf55b165be35ed
      Policies:
        - Statement:
            - Effect: Allow
              Action:
                - secretsmanager:GetSecretValue
              Resource:
                - !Sub "arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:cri/fraud/experian/keystore-*"

  TestFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: build/distributions/di-cri-experian-kbv-api.zip
      Handler: uk.gov.di.ipv.cri.kbv.TestHandler
      VpcConfig:
        SecurityGroupIds:
          - sg-03a1efaf2fed58442
        SubnetIds:
          - subnet-07fcf55b165be35ed
